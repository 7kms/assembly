# 寄存器(内存访问)
从内存访问的角度了解寄存器

## 内存中字的存储
cpu中用16位寄存器来存储一个字. 高8位存放高位字节, 低8位存放低位字节. 由于内存单元是字节单元,一个字需要2个连续的内存单元来存放.

任何2个地址连续的内存单元,N和N+1号单元,可以将它们看成两个内存单元,也可以看成是一个地址为N的字单元中的高位字节单元和低位字节单元

## DS和[address]
8086CPU中有一个DS寄存器,通常用来存放要访问数据的段地址. 

比如要读取10000H中的内容

```s
mov bx,1000H
mov ds,bx
mov al,[0]
```

mov,add,sub指令形式:

| 指令形式 | 例子 |
| :---- | :---- |
|mov 寄存器,数据| mov ax,8|
|mov 寄存器,寄存器| mov bx,ax|
|mov 寄存器,内存单元| mov ax,[0]|
|mov 内存单元,寄存器| mov [0],ax|
|mov 内存单元,段寄存器| mov [0],ds|
|mov 段寄存器,内存单元| mov ds,[0]|
|mov 段寄存器,寄存器| mov ds,ax|
|mov 寄存器,段寄存器| mov ax,ds|
|add 寄存器,数据| add ax,8|
|add 寄存器,寄存器| add bx,ax|
|add 寄存器,内存单元| add ax,[0]|
|add 内存单元,寄存器| add [0],ax|
|sub 寄存器,数据| sub ax,8|
|sub 寄存器,寄存器| sub bx,ax|
|sub 寄存器,内存单元| sub ax,[0]|
|sub 内存单元,寄存器| sub [0],ax|

`[...]`表示一个内存单元,`[...]`中的0表示内存单元的偏移地址

## 数据段

1. 定义数据段: 在编程时,可以根据需要,将一组内存单元(起始地址必须为16的倍数, 长度为N<=64KB)定义为一个段
2. 访问数据段: mov,add,sub,jmp等指令

如将`123B0H~123B9H`的内存单元定义为数据段(起始地址`123BH`, 长度为`10`个字节),现在需要累加该数据段前3个单元中的数据

```s

mov ax,123B
mov ds,ax
mov al,0
add al,[0]
add al,[1]
add al,[2]

```
## cpu提供的栈机制
8086CPU可以将一段内存当做栈来使用. 8086CPU中入栈和出栈的操作都是以字为单位
1. push 入栈: 如 `push ax`表示将寄存器ax的值送入栈中
2. pop 出栈:如 `push ax`表示从栈顶取出数据送入ax

有如下指令

```s
mov ax,0123H
push ax
mov bx,2266H
push bx
mov cx,1122H
push cx
pop ax
pop bx
pop cx
```
下图描述其执行过程

![](../snapshots/3.9.png)

注意:
字型数据用2个单元存放, 高地址单元存放高8位, 低地址单元存放低8位

### 相关寄存器

任意时刻, `SS:SP`指向栈顶元素

`push ax`执行分为2步(入栈时,栈顶从高地址向低地址方向增长)

1. `SP=SP-2`,`SS:SP`指向当前栈顶前面的单元,以当前栈顶前面的单元为新的栈顶
2. 将ax中的内容送入`SS:SP`指向的内存单元处,`SS:SP`此时指向新栈顶

![](../snapshots/3.10.png)

`pop ax`的执行过程和`push ax`相反

1. 将`SS:SP`指向内存单元处的数据送入`ax`中
2. `SP=SP+2`,`SS:SP`指向当前栈顶下面的单元,以当前栈顶下面的单元为新的栈顶

![](../snapshots/3.12.png)